{% extends "base.html" %}
{% block content %}

<div class="hero" style="padding: 3rem 2rem; text-align: left;">
  <div style="max-width: 800px;">
    <h1>Dashboard</h1>
    <p>Welcome back, <b>{{ session.get("name") }}</b>. Here's what's happening with your health today.</p>
  </div>
</div>

<!-- Stats Row -->
<div class="stats-row">
  <div class="stat-item">
    <div class="label">Total Bookings</div>
    <div class="value">{{ appointments|length }}</div>
    <div class="trend up"><span>‚Üë</span> Overall history</div>
  </div>
  <div class="stat-item">
    <div class="label">Pending</div>
    <div class="value">
      {% set pending_count = appointments|selectattr('status', 'equalto', 'Pending')|list|length %}
      {{ pending_count }}
    </div>
    <div class="trend" style="color: var(--warning);"><span>‚è≥</span> Awaiting approval</div>
  </div>
  <div class="stat-item">
    <div class="label">Active Doctors</div>
    <div class="value">
      {% set doctors_list = [] %}
      {% for a in appointments %}
      {% if a.doctor_name not in doctors_list %}
      {% set _ = doctors_list.append(a.doctor_name) %}
      {% endif %}
      {% endfor %}
      {{ doctors_list|length }}
    </div>
    <div class="trend up"><span>üè†</span> Multiple specialists</div>
  </div>
</div>

<div class="table-container">
  <table class="table">
    <thead>
      <tr>
        <th>Doctor Profile</th>
        <th>Specialization</th>
        <th>Date & Time</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for a in appointments %}
      <tr>
        <td>
          <div style="display: flex; align-items: center; gap: 0.75rem;">
            <div
              style="width: 32px; height: 32px; border-radius: 8px; background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; color: white;">
              {{ a.doctor_name[4] if a.doctor_name.startswith('Dr. ') else a.doctor_name[0] }}
            </div>
            <span style="font-weight: 600;">{{ a.doctor_name }}</span>
          </div>
        </td>
        <td style="color: var(--muted);">{{ a.doctor_specialization }}</td>
        <td>
          <div style="font-weight: 500;">{{ a.date }}</div>
          <div style="font-size: 0.8rem; color: var(--muted);">{{ a.time }}</div>
        </td>
        <td>
          <span class="badge 
            {% if a.status == 'Approved' or a.status == 'Completed' %}success{% endif %}
            {% if a.status == 'Cancelled' %}danger{% endif %}
            {% if a.status == 'Pending' %}warn{% endif %}
          ">
            {{ a.status }}
          </span>
        </td>
        <td>
          {% if a.status == 'Pending' or a.status == 'Approved' %}
          <a class="btn" href="/cancel/{{ a.id }}" style="padding: 0.4rem 0.75rem; font-size: 0.75rem;">Cancel
            Booking</a>
          {% else %}
          <span style="color:var(--muted); font-size:.8rem;">No Actions</span>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="5" style="text-align: center; padding: 3rem; color: var(--muted);">
          No appointments recorded. <a href="/doctors" style="color: var(--primary);">Book your first one!</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}