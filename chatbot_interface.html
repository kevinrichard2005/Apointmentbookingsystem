{% extends "base.html" %}
{% block content %}

<div class="hero">
  <h1>AI Health Assistant</h1>
  <p>Get instant answers about appointments, doctors, and basic medical guidance.</p>
</div>

<div class="grid" style="margin-top: 20px;">
  <div class="card" style="grid-column: span 8;">
    <h3>üí¨ Chat with MediBook AI</h3>
    <div id="chat-container" style="height: 500px; overflow-y: auto; margin-top: 15px; padding: 15px; border-radius: 12px; background: rgba(16,26,45,.5); border: 1px solid var(--border);">
      <!-- Chat messages will appear here -->
      <div class="chat-message ai">
        <div class="message-bubble">
          <strong>MediBook AI:</strong> Hello! I'm your healthcare assistant. I can help you with appointment booking, finding doctors, and basic medical information. How can I assist you today?
        </div>
        <div class="message-time">Just now</div>
      </div>
    </div>
    
    <div style="margin-top: 15px;">
      <div id="suggestions" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
        <!-- Quick suggestions will be loaded here -->
      </div>
      
      <div style="display: flex; gap: 10px;">
        <input type="text" id="chat-input" placeholder="Type your question here..." style="flex: 1; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: rgba(255,255,255,.05); color: var(--text);" />
        <button id="send-btn" class="btn btn-primary">Send</button>
      </div>
      <p style="color: var(--muted); font-size: 0.85rem; margin-top: 8px;">
        Note: This AI provides general guidance only. For medical emergencies, call emergency services.
      </p>
    </div>
  </div>
  
  <div class="card" style="grid-column: span 4;">
    <h3>ü§ñ AI Capabilities</h3>
    <div style="margin-top: 15px;">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding: 10px; border-radius: 10px; background: rgba(79,70,229,.1);">
        <div style="width: 32px; height: 32px; background: linear-gradient(90deg, var(--primary), var(--primary2)); border-radius: 8px; display: flex; align-items: center; justify-content: center;">üìÖ</div>
        <div>
          <strong>Appointment Booking</strong>
          <p style="color: var(--muted); font-size: 0.9rem; margin: 2px 0 0 0;">Guide you through booking process</p>
        </div>
      </div>
      
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding: 10px; border-radius: 10px; background: rgba(34,197,94,.1);">
        <div style="width: 32px; height: 32px; background: #22c55e; border-radius: 8px; display: flex; align-items: center; justify-content: center;">üë®‚Äç‚öïÔ∏è</div>
        <div>
          <strong>Doctor Search</strong>
          <p style="color: var(--muted); font-size: 0.9rem; margin: 2px 0 0 0;">Find specialists by category</p>
        </div>
      </div>
      
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding: 10px; border-radius: 10px; background: rgba(234,179,8,.1);">
        <div style="width: 32px; height: 32px; background: #eab308; border-radius: 8px; display: flex; align-items: center; justify-content: center;">‚ÑπÔ∏è</div>
        <div>
          <strong>Basic Medical Info</strong>
          <p style="color: var(--muted); font-size: 0.9rem; margin: 2px 0 0 0;">General health guidance</p>
        </div>
      </div>
      
      <div style="display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 10px; background: rgba(124,58,237,.1);">
        <div style="width: 32px; height: 32px; background: var(--primary2); border-radius: 8px; display: flex; align-items: center; justify-content: center;">‚ö°</div>
        <div>
          <strong>Quick Support</strong>
          <p style="color: var(--muted); font-size: 0.9rem; margin: 2px 0 0 0;">24/7 instant responses</p>
        </div>
      </div>
    </div>
    
    <h4 style="margin-top: 20px; margin-bottom: 10px;">üö® Important Notice</h4>
    <div style="padding: 12px; border-radius: 10px; background: rgba(239,68,68,.1); border: 1px solid rgba(239,68,68,.3);">
      <p style="color: #ef4444; font-size: 0.9rem; margin: 0;">
        <strong>Medical Emergency?</strong><br>
        Call your local emergency number or go to the nearest hospital immediately.
      </p>
    </div>
  </div>
</div>

<style>
  .chat-message {
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
  }
  
  .chat-message.user {
    align-items: flex-end;
  }
  
  .chat-message.ai {
    align-items: flex-start;
  }
  
  .message-bubble {
    padding: 12px 16px;
    border-radius: 18px;
    max-width: 80%;
    word-wrap: break-word;
    white-space: pre-line;
  }
  
  .chat-message.user .message-bubble {
    background: linear-gradient(90deg, var(--primary), var(--primary2));
    color: white;
    border-bottom-right-radius: 4px;
  }
  
  .chat-message.ai .message-bubble {
    background: rgba(255,255,255,.08);
    border: 1px solid var(--border);
    border-bottom-left-radius: 4px;
  }
  
  .message-time {
    font-size: 0.75rem;
    color: var(--muted);
    margin-top: 4px;
  }
  
  .suggestion-chip {
    padding: 8px 12px;
    background: rgba(79,70,229,.15);
    border: 1px solid rgba(79,70,229,.3);
    border-radius: 20px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .suggestion-chip:hover {
    background: rgba(79,70,229,.25);
    transform: translateY(-2px);
  }
  
  #chat-container::-webkit-scrollbar {
    width: 6px;
  }
  
  #chat-container::-webkit-scrollbar-track {
    background: rgba(255,255,255,.05);
    border-radius: 3px;
  }
  
  #chat-container::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 3px;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const chatContainer = document.getElementById('chat-container');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const suggestionsContainer = document.getElementById('suggestions');
    
    // Load quick suggestions
    fetch('/ai/chat/suggestions')
      .then(response => response.json())
      .then(data => {
        data.suggestions.forEach(suggestion => {
          const chip = document.createElement('div');
          chip.className = 'suggestion-chip';
          chip.textContent = suggestion;
          chip.addEventListener('click', () => {
            chatInput.value = suggestion;
            sendMessage();
          });
          suggestionsContainer.appendChild(chip);
        });
      });
    
    // Send message on button click
    sendBtn.addEventListener('click', sendMessage);
    
    // Send message on Enter key
    chatInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });
    
    function sendMessage() {
      const message = chatInput.value.trim();
      if (!message) return;
      
      // Add user message to chat
      addMessage(message, 'user');
      chatInput.value = '';
      
      // Scroll to bottom
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      // Show loading indicator
      const loadingId = addMessage('Thinking...', 'ai', true);
      
      // Send to server
      fetch('/ai/chat', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ message: message })
      })
      .then(response => response.json())
      .then(data => {
        // Remove loading message
        const loadingMsg = document.getElementById(loadingId);
        if (loadingMsg) loadingMsg.remove();
        
        if (data.error) {
          addMessage('Sorry, I encountered an error. Please try again.', 'ai');
        } else {
          addMessage(data.response, 'ai');
        }
      })
      .catch(error => {
        // Remove loading message
        const loadingMsg = document.getElementById(loadingId);
        if (loadingMsg) loadingMsg.remove();
        
        addMessage('Connection error. Please check your internet.', 'ai');
      });
    }
    
    function addMessage(text, sender, isLoading = false) {
      const messageDiv = document.createElement('div');
      const messageId = 'msg-' + Date.now();
      
      if (isLoading) {
        messageDiv.id = messageId;
      }
      
      messageDiv.className = `chat-message ${sender}`;
      
      const bubble = document.createElement('div');
      bubble.className = 'message-bubble';
      
      if (sender === 'ai') {
        bubble.innerHTML = `<strong>MediBook AI:</strong> ${text}`;
      } else {
        bubble.textContent = text;
      }
      
      const time = document.createElement('div');
      time.className = 'message-time';
      time.textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      messageDiv.appendChild(bubble);
      messageDiv.appendChild(time);
      chatContainer.appendChild(messageDiv);
      
      // Scroll to bottom
      chatContainer.scrollTop = chatContainer.scrollHeight;
      
      return messageId;
    }
    
    // Focus on input when page loads
    chatInput.focus();
  });
</script>

{% endblock %}